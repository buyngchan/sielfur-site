<script type="module">
  import { auth, db } from "./js/firebase.js";  // ⚠ storage 빼기!
  import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      // 로그아웃 후 가는 페이지
      location.href = "index.html";
      return;
    }

    document.getElementById("username").innerText = user.displayName ?? "익명 사용자";
    document.getElementById("email").innerText = user.email ?? "";
    if (user.photoURL) document.getElementById("profileImg").src = user.photoURL;

    // 내 커미션 목록 불러오기
    const q = query(collection(db, "commissions"), where("uid", "==", user.uid));
    const snap = await getDocs(q);
    const box = document.getElementById("myPosts");

    if (snap.empty) {
      box.innerHTML = "<div style='color:#777;'>아직 등록한 커미션이 없습니다.</div>";
      return;
    }

    box.innerHTML = "";
    snap.forEach(doc => {
      const d = doc.data();
      box.innerHTML += `
        <div class="commission-item">
          <img src="${d.image}">
          <div class="comm-text">
            <div class="title">${d.title}</div>
            <div class="price">${d.price}원</div>
            <a href="commission.html?id=${doc.id}" style="font-size:14px; color:#3182f6; margin-top:6px; display:block;">상세 보기</a>
          </div>
        </div>
      `;
    });
  });

  // 프로필 수정 페이지로 이동
  document.getElementById("editProfileBtn").addEventListener("click", () => {
    location.href = "edit-profile.html";   // 파일 이름이랑 정확히 같아야 함
  });

  // 로그아웃 → index.html 이동
  document.getElementById("logoutBtn").addEventListener("click", async () => {
    await signOut(auth);
    location.href = "index.html";        // 로그인 페이지가 login.html이면 거기로 바꿔도 됨
  });
</script>
