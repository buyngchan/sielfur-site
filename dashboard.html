<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë‚´ ëŒ€ì‹œë³´ë“œ | JJUB STUDIO</title>

  <style>
    body {
      margin: 0;
      font-family: "Pretendard", system-ui, sans-serif;
      background: #f5f7fa;
      color: #222;
    }

    header {
      background: white;
      padding: 20px;
      font-size: 20px;
      font-weight: 700;
      border-bottom: 1px solid #eee;
    }

    .card {
      background: white;
      margin: 18px;
      padding: 22px;
      border-radius: 18px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.03);
    }

    .user-box {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .user-box img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: #ddd;
      object-fit: cover;
      cursor: pointer;
    }

    .user-name {
      font-size: 18px;
      font-weight: 600;
    }

    .edit-btn {
      font-size: 13px;
      color: #3182f6;
      cursor: pointer;
      margin-top: 6px;
    }

    .btn-primary {
      display: block;
      width: 100%;
      padding: 15px;
      background: #3182f6;
      color: white;
      text-align: center;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      text-decoration: none;
      margin-top: 16px;
    }

    .commission-item {
      display: flex;
      gap: 16px;
      padding: 14px 0;
      border-bottom: 1px solid #eee;
    }

    .commission-item:last-child { border-bottom: none; }

    .commission-item img {
      width: 80px;
      height: 80px;
      border-radius: 12px;
      object-fit: cover;
    }

    .logout {
      margin-top: 14px;
      text-align: center;
      color: #777;
      font-size: 14px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>ë‚´ ëŒ€ì‹œë³´ë“œ</header>

  <div class="card">
    <div class="user-box">
      <img src="img/default-profile.png" id="profileImg">
      <div>
        <div class="user-name" id="username">ë¡œê·¸ì¸ ì¤‘...</div>
        <div id="email" style="color:#666; font-size:14px;"></div>

        <!-- ğŸ”¥ í”„ë¡œí•„ ìˆ˜ì •í•˜ê¸° ë²„íŠ¼ â†’ edit-profile.html ì´ë™ -->
        <div class="edit-btn" id="editProfileBtn">í”„ë¡œí•„ ìˆ˜ì •í•˜ê¸°</div>
      </div>
    </div>

    <a href="new-commission.html" class="btn-primary">+ ìƒˆ ì»¤ë¯¸ì…˜ ë“±ë¡</a>
    <div class="logout" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 16px 0; font-size:18px;">ë‚´ ì»¤ë¯¸ì…˜ ëª©ë¡</h3>
    <div id="myPosts">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  </div>

  <script type="module">
    import { auth, db, storage } from "./js/firebase.js";
    import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        location.href = "index.html";
        return;
      }

      document.getElementById("username").innerText = user.displayName ?? "ìµëª… ì‚¬ìš©ì";
      document.getElementById("email").innerText = user.email ?? "";
      if (user.photoURL) document.getElementById("profileImg").src = user.photoURL;

      const q = query(collection(db, "commissions"), where("uid", "==", user.uid));
      const snap = await getDocs(q);
      const box = document.getElementById("myPosts");

      if (snap.empty) {
        box.innerHTML = "<div style='color:#777;'>ì•„ì§ ë“±ë¡í•œ ì»¤ë¯¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.</div>";
        return;
      }

      box.innerHTML = "";
      snap.forEach(doc => {
        const d = doc.data();
        box.innerHTML += `
          <div class="commission-item">
            <img src="${d.image}">
            <div class="comm-text">
              <div class="title">${d.title}</div>
              <div class="price">${d.price}ì›</div>
              <a href="commission.html?id=${doc.id}" style="font-size:14px; color:#3182f6; margin-top:6px; display:block;">ìƒì„¸ ë³´ê¸°</a>
            </div>
          </div>
        `;
      });
    });

    // ğŸš€ í”„ë¡œí•„ ìˆ˜ì • ë²„íŠ¼ â†’ edit-profile.html ì´ë™
    document.getElementById("editProfileBtn").addEventListener("click", () => {
      location.href = "edit-profile.html";
    });

    // ë¡œê·¸ì•„ì›ƒ
    document.getElementById("logoutBtn").addEventListener("click", async () => {
      await signOut(auth);
      location.href = "index.html";
    });
  </script>
</body>
</html>
