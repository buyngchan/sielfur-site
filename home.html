<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>í™ˆ í”¼ë“œ | JJUB STUDIO</title>

  <style>
    body {
      margin: 0;
      font-family: "Pretendard", system-ui, sans-serif;
      background: #f5f7fa;
      color: #222;
    }

    /* ìƒë‹¨ í—¤ë” */
    header {
      background: white;
      padding: 14px 16px;
      border-bottom: 1px solid #eee;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .header-inner {
      max-width: 960px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .back-link {
      font-size: 13px;
      color: #3182f6;
      text-decoration: none;
    }

    .header-title {
      font-size: 18px;
      font-weight: 700;
    }

    .header-right {
      font-size: 13px;
      color: #666;
    }

    /* ì»¨í…Œì´ë„ˆ */
    .container {
      max-width: 960px;
      margin: 16px auto 32px;
      padding: 0 16px;
      box-sizing: border-box;
    }

    .section-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .section-sub {
      font-size: 13px;
      color: #777;
      margin-bottom: 16px;
    }

    /* í”¼ë“œ ê·¸ë¦¬ë“œ */
    .feed-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 16px;
    }

    .card-comm {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.03);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      cursor: pointer;
      text-decoration: none;
      color: inherit;
      transition: transform 0.12s ease, box-shadow 0.12s ease;
    }

    .card-comm:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    }

    .card-thumb {
      width: 100%;
      height: 160px;
      background: #ddd;
      object-fit: cover;
    }

    .card-body {
      padding: 12px 13px 13px;
    }

    .card-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 4px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .card-price {
      font-size: 14px;
      color: #3182f6;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .card-author {
      font-size: 12px;
      color: #666;
      margin-bottom: 6px;
    }

    .card-desc {
      font-size: 12px;
      color: #555;
      max-height: 32px;
      overflow: hidden;
    }

    .empty-text {
      font-size: 14px;
      color: #777;
      margin-top: 10px;
    }

    .loading {
      font-size: 14px;
      color: #666;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <div class="header-left">
        <a href="dashboard.html" class="back-link">â† ë‚´ ëŒ€ì‹œë³´ë“œ</a>
        <div class="header-title">í™ˆ í”¼ë“œ</div>
      </div>
      <div class="header-right">
        ë‹¤ë¥¸ ì‘ê°€ë“¤ì˜ ì»¤ë¯¸ì…˜ì„ ë‘˜ëŸ¬ë³´ì„¸ìš”
      </div>
    </div>
  </header>

  <main class="container">
    <div class="section-title">ì „ì²´ ì»¤ë¯¸ì…˜ í”¼ë“œ</div>
    <div class="section-sub">ë‚´ê°€ ì˜¬ë¦° ê²ƒ ë¹¼ê³ , ë‹¤ë¥¸ ìœ ì €ë“¤ì´ ì˜¬ë¦° ì»¤ë¯¸ì…˜ì´ ë³´ì—¬ìš”.</div>

    <div id="feedStatus" class="loading">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    <div id="feedGrid" class="feed-grid"></div>
  </main>

  <script type="module">
    // Firebase SDK from CDN
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { 
      getAuth, 
      onAuthStateChanged 
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { 
      getFirestore, 
      collection, 
      getDocs, 
      query, 
      orderBy 
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // ğŸ”¥ ë„¤ í”„ë¡œì íŠ¸ ì„¤ì • (ê°™ì€ config ì¬ì‚¬ìš©)
    const firebaseConfig = {
      apiKey: "AIzaSyA7UuqPTbv22dFHz5ugxdwnz0XDTDUQiP0",
      authDomain: "jjub0812.firebaseapp.com",
      projectId: "jjub0812",
      storageBucket: "jjub0812.firebasestorage.app",
      messagingSenderId: "713500860924",
      appId: "1:713500860924:web:364e16fa1d2a1dbbef5279",
      measurementId: "G-X7MESKH6MX"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const feedGrid = document.getElementById("feedGrid");
    const feedStatus = document.getElementById("feedStatus");

    onAuthStateChanged(auth, async (user) => {
      try {
        // ë¡œê·¸ì¸ ì•ˆ ë˜ì–´ ìˆì–´ë„ ê·¸ëƒ¥ ì „ì²´ í”¼ë“œ ë³´ì—¬ì£¼ê³  ì‹¶ìœ¼ë©´ ì´ ifë¬¸ ì œê±°í•˜ë©´ ë¨
        if (!user) {
          alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
          location.href = "login.html";
          return;
        }

        // ì»¤ë¯¸ì…˜ ì „ì²´ ë¶ˆëŸ¬ì˜¤ê¸° (ìµœì‹ ìˆœ)
        const q = query(collection(db, "commissions"), orderBy("createdAt", "desc"));
        const snap = await getDocs(q);

        if (snap.empty) {
          feedStatus.textContent = "ì•„ì§ ë“±ë¡ëœ ì»¤ë¯¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.";
          return;
        }

        feedStatus.textContent = "";
        feedGrid.innerHTML = "";

        snap.forEach(doc => {
          const d = doc.data();

          // ğŸ”¹ ë‚´ ì»¤ë¯¸ì…˜ì€ ì œì™¸ (ë‚´ê°€ ì•„ë‹Œ ë‹¤ë¥¸ ì‚¬ëŒ ê²ƒë§Œ)
          if (d.uid === user.uid) return;

          const id = doc.id;
          const image = d.image || "img/default-profile.png";
          const title = d.title || "ì œëª© ì—†ìŒ";
          const price = d.price != null ? `${d.price}ì›` : "ê°€ê²© ë¯¸ì •";
          const authorName = d.authorName || "ìµëª… ì‘ê°€";
          const shortDesc = d.shortDesc || d.description || "";

          const card = document.createElement("a");
          card.href = `commission.html?id=${id}`;
          card.className = "card-comm";

          card.innerHTML = `
            <img src="${image}" class="card-thumb" alt="ì»¤ë¯¸ì…˜ ì´ë¯¸ì§€">
            <div class="card-body">
              <div class="card-title">${title}</div>
              <div class="card-price">${price}</div>
              <div class="card-author">by ${authorName}</div>
              <div class="card-desc">${shortDesc}</div>
            </div>
          `;

          feedGrid.appendChild(card);
        });

        // ëª¨ë“  ë¬¸ì„œê°€ ë‚´ ê²ƒë¿ì´ì—ˆìœ¼ë©´?
        if (!feedGrid.children.length) {
          feedStatus.textContent = "í˜„ì¬ ë‹¤ë¥¸ ì‚¬ëŒì´ ì˜¬ë¦° ì»¤ë¯¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.";
        }

      } catch (err) {
        console.error(err);
        feedStatus.textContent = "í”¼ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
      }
    });
  </script>
</body>
</html>
